name = "project-moria"
main = "src/index.ts"
compatibility_date = "2024-12-18"
compatibility_flags = ["nodejs_compat"]
assets = { directory = "public" }

# Development settings
[dev]
port = 8787

# D1 SQLite Database (local development only - comment out for --remote)
# [[d1_databases]]
# binding = "DB"
# database_name = "moria-db"
# database_id = "local-dev-db"
# migrations_dir = "migrations"

# Hyperdrive for PlanetScale Postgres
[[hyperdrive]]
binding = "HYPERDRIVE"
id = "86f82eb0f81b438781b653c5730aa714"
# localConnectionString is set via WRANGLER_HYPERDRIVE_LOCAL_CONNECTION_STRING_HYPERDRIVE in .dev.vars

# Environment variables (set in dashboard or via wrangler secret)
# DATABASE_URL - Neon Postgres connection string (production)
# ALBY_API_KEY - Alby API key for Lightning payments
# JWT_SECRET - Secret for signing JWT tokens

# Production environment (uses Neon PostgreSQL via DATABASE_URL)
[env.production]
name = "project-moria-production"
routes = [
  { pattern = "gw.telcharlabs.io", custom_domain = true }
]

[[env.production.hyperdrive]]
binding = "HYPERDRIVE"
id = "86f82eb0f81b438781b653c5730aa714"

# Cron trigger for auto-payouts (every 5 minutes)
[env.production.triggers]
crons = ["*/5 * * * *"]

# Staging environment
[env.staging]
name = "project-moria-staging"
